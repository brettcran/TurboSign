<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>PDFill-Sign Final</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js"></script>
<script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
  body.light{background:#f5f5f5;color:#000;}body.dark{background:#1e1e1e;color:#fff;}body{margin:0;font-family:Arial;transition:background .3s,color .3s}.sidebar{width:72px;background:#2f2f2f;position:fixed;top:0;bottom:0;left:0;display:flex;flex-direction:column;align-items:center;padding:10px 0;z-index:1000}.sidebar button{background:none;border:none;margin:10px 0;cursor:pointer;display:flex;flex-direction:column;align-items:center;font-size:26px;color:#fff}.sidebar button span.label{font-size:10px;color:#ddd;margin-top:2px}.sidebar button.active{border:2px solid #4CAF50;box-shadow:0 0 10px #4CAF50}#pdf-container{margin-left:72px;padding:20px;overflow-y:auto;height:100vh;position:relative}canvas{display:block;margin-bottom:20px;background:#fff;border:1px solid #ccc}.draggable{position:absolute;font-weight:bold;cursor:move;user-select:none;font-family:Arial;white-space:pre-wrap;word-break:break-word;max-width:400px;min-width:50px}#settings-modal,#sig-modal,#help-modal,#backdrop{display:none;position:fixed;z-index:1001}#backdrop{width:100%;height:100%;background:rgba(0,0,0,.5);top:0;left:0;z-index:1000}.modal-centered{top:50%;left:50%;transform:translate(-50%,-50%);background:#fff;padding:20px;border-radius:10px;color:#000;z-index:1001;position:fixed}@media (max-width:768px){.sidebar{width:56px}#pdf-container{margin-left:56px;padding:10px}.modal-centered{width:90%;max-width:400px}}
</style>
<script>
let annotations=[],defaultFontSize=15,defaultColor='#000',defaultFontFamily='Arial';
function triggerUpload(){document.getElementById('file-input').click()}
function setMode(m){window.currentMode=(window.currentMode===m?null:m);document.querySelectorAll('.sidebar button').forEach(b=>b.classList.remove('active'));if(window.currentMode){document.querySelectorAll('.sidebar button').forEach(b=>{if((m==='text'&&b.textContent.includes('T'))||(m==='sign'&&b.textContent.includes('Sign'))){b.classList.add('active')}})}}
function openSigModal(){document.getElementById('sig-modal').style.display='block';document.getElementById('backdrop').style.display='block';setMode('sign')}
function openSettings(){document.getElementById('settings-modal').style.display='block';document.getElementById('backdrop').style.display='block'}
function openHelpModal(){document.getElementById('help-modal').style.display='block';document.getElementById('backdrop').style.display='block'}
function closeModals(){document.querySelectorAll('#help-modal,#settings-modal,#sig-modal').forEach(e=>e.style.display='none');document.getElementById('backdrop').style.display='none'}
function applySettings(){const fs=document.getElementById('font-size'),fc=document.getElementById('font-color'),ff=document.getElementById('font-family');defaultFontSize=parseInt(fs.value)||15;defaultColor=fc.value||'#000';defaultFontFamily=ff.value||'Arial';document.querySelectorAll('.draggable').forEach(el=>{el.style.fontSize=defaultFontSize+'px';el.style.color=defaultColor;el.style.fontFamily=defaultFontFamily});closeModals()}
function resetDefaults(){defaultFontSize=15;defaultColor='#000';defaultFontFamily='Arial';document.getElementById('font-size').value=15;document.getElementById('font-color').value='#000000';document.getElementById('font-family').value='Arial';document.querySelectorAll('.draggable').forEach(el=>{el.style.fontSize='15px';el.style.color='#000';el.style.fontFamily='Arial'});closeModals()}
async function exportPDF(){const {PDFDocument,rgb}=window.PDFLib,pdfDoc=await PDFDocument.create(),canvases=document.querySelectorAll('#pdf-container canvas');for(const c of canvases){const p=pdfDoc.addPage([c.width,c.height]),jpg=await pdfDoc.embedJpg(c.toDataURL('image/jpeg',.8));p.drawImage(jpg,{x:0,y:0,width:c.width,height:c.height});for(const a of annotations.filter(x=>x.canvas===c)){const r=a.el.getBoundingClientRect(),cr=c.getBoundingClientRect(),x=r.left-cr.left,y=c.height-(r.top-cr.top)-r.height;if(a.el.tagName==='IMG'){const png=await pdfDoc.embedPng(a.el.src);p.drawImage(png,{x,y,width:r.width,height:r.height})}else{p.drawText(a.el.textContent||'',{x,y,size:parseInt(a.el.style.fontSize)||15,color:rgb(0,0,0)})}}}const pdfBytes=await pdfDoc.save(),link=document.createElement('a');link.href=URL.createObjectURL(new Blob([pdfBytes],{type:'application/pdf'}));link.download='annotated.pdf';link.click()}

document.addEventListener('DOMContentLoaded',()=>{
 ['sig-close','settings-close','help-close'].forEach(id=>{const b=document.getElementById(id);if(b)b.addEventListener('click',closeModals)});
 const fi=document.getElementById('file-input'),pc=document.getElementById('pdf-container'),sc=document.getElementById('sig-canvas'),ctx=sc.getContext('2d');
 let ps=null,sp=null;ctx.lineCap='round';ctx.lineJoin='round';ctx.lineWidth=2;ctx.strokeStyle='#000';
 function gp(e){const r=sc.getBoundingClientRect(),cx=e.touches?e.touches[0].clientX:e.clientX,cy=e.touches?e.touches[0].clientY:e.clientY;return{x:cx-r.left,y:cy-r.top}}
 let d=false;function sd(e){e.preventDefault();d=true;const {x,y}=gp(e);ctx.beginPath();ctx.moveTo(x,y)}function dr(e){if(!d)return;e.preventDefault();const {x,y}=gp(e);ctx.lineTo(x,y);ctx.stroke()}function ed(e){if(!d)return;e.preventDefault();d=false;ctx.closePath()}
 sc.addEventListener('mousedown',sd);sc.addEventListener('mousemove',dr);sc.addEventListener('mouseup',ed);sc.addEventListener('mouseout',ed);
 sc.addEventListener('touchstart',sd);sc.addEventListener('touchmove',dr);sc.addEventListener('touchend',ed);
 document.getElementById('clearSig').addEventListener('click',()=>ctx.clearRect(0,0,sc.width,sc.height));
 document.getElementById('saveSig').addEventListener('click',()=>{const d=sc.toDataURL();ps=d;sp=document.createElement('img');sp.src=d;sp.style.position='fixed';sp.style.opacity='0.5';sp.style.pointerEvents='none';sp.style.width='200px';sp.style.zIndex='2000';document.body.appendChild(sp);document.addEventListener('mousemove',mv);closeModals()});
 function mv(e){if(sp){sp.style.left=e.clientX-sp.offsetWidth/2+'px';sp.style.top=e.clientY-sp.offsetHeight/2+'px'}}
 pc.addEventListener('click',e=>{if(!ps||!e.target.closest('canvas'))return;const c=e.target.closest('canvas'),ct=c.parentElement,img=document.createElement('img');img.src=ps;img.style.position='absolute';img.style.left=e.offsetX+'px';img.style.top=e.offsetY+'px';img.className='draggable';ct.appendChild(img);annotations.push({el:img,canvas:c});img.style.resize='both';img.style.overflow='auto';en(img,true);ps=null;if(sp){document.body.removeChild(sp);sp=null}document.removeEventListener('mousemove',mv);setMode(null)});
 pc.addEventListener('dblclick',e=>{if(window.currentMode!=='text'||!e.target.closest('canvas'))return;const c=e.target.closest('canvas'),ct=c.parentElement,el=document.createElement('div');el.textContent='Enter text';el.contentEditable=true;el.className='draggable';el.style.position='absolute';el.style.left=e.offsetX+'px';el.style.top=e.offsetY+'px';el.style.fontSize=defaultFontSize+'px';el.style.color=defaultColor;el.style.fontFamily=defaultFontFamily;ct.appendChild(el);annotations.push({el,canvas:c});en(el,false)});
 function en(el,r){let ox,oy,down=false;el.addEventListener('mousedown',e=>{if(el.isContentEditable&&e.target===el)return;down=true;ox=e.clientX-parseFloat(el.style.left||0);oy=e.clientY-parseFloat(el.style.top||0);e.preventDefault()});document.addEventListener('mouseup',()=>down=false);document.addEventListener('mousemove',e=>{if(!down)return;el.style.left=e.clientX-ox+'px';el.style.top=e.clientY-oy+'px'});if(r){el.style.resize='both';el.style.overflow='auto'}el.addEventListener('contextmenu',e=>{e.preventDefault();if(confirm('Delete this item?'))el.remove()})}
 function lp(f){const r=new FileReader();r.onload=function(){pdfjsLib.getDocument({data:new Uint8Array(this.result)}).promise.then(pdf=>{pc.innerHTML='';for(let i=1;i<=pdf.numPages;i++){pdf.getPage(i).then(p=>rp(p))}})};r.readAsArrayBuffer(f)}
 function rp(p){const v=p.getViewport({scale:1}),mw=window.innerWidth*.9,mh=window.innerHeight*.9,s=Math.min(mw/v.viewBox[2],mh/v.viewBox[3]),vp=p.getViewport({scale:s}),c=document.createElement('canvas'),cx=c.getContext('2d');c.width=vp.width;c.height=vp.height;p.render({canvasContext:cx,viewport:vp}).promise.then(()=>{const w=document.createElement('div');w.style.position='relative';w.appendChild(c);pc.appendChild(w)})}
 fi.addEventListener('change',e=>{if(e.target.files.length)lp(e.target.files[0])});
});
</script>
</head>
<body class="light">
<div class="sidebar">
  <button onclick="triggerUpload()">üìÇ<span class="label">Open</span></button>
  <button onclick="setMode('text')">T<span class="label">Text</span></button>
  <button onclick="openSigModal()">‚úç<span class="label">Sign</span></button>
  <button onclick="exportPDF()">‚¨á<span class="label">Save</span></button>
  <button onclick="openSettings()">‚öôÔ∏è<span class="label">Settings</span></button>
  <button onclick="openHelpModal()" style="color:red;">‚ùì<span class="label">Help</span></button>
</div>
<input type="file" id="file-input" accept="application/pdf" style="display:none"/>
<div id="pdf-container"></div>
<div id="backdrop" onclick="closeModals()"></div>
<div id="sig-modal" class="modal-centered"><button class="modal-close" id="sig-close">√ó</button><canvas id="sig-canvas" width="600" height="200" style="border:1px solid #ccc;display:block;margin:20px auto;background:#fff;"></canvas><button id="clearSig">Clear</button><button id="saveSig">Save</button></div>
<div id="settings-modal" class="modal-centered"><button class="modal-close" id="settings-close">√ó</button><div style="display:flex;flex-direction:column;gap:10px;align-items:flex-start;padding:15px;"><label for="font-family">Font:</label><select id="font-family"><option value="Arial" selected>Arial</option><option value="Times New Roman">Times New Roman</option><option value="Courier New">Courier New</option><option value="Verdana">Verdana</option></select><label for="font-size">Font Size:</label><select id="font-size"><option value="10">10</option><option value="15" selected>15</option><option value="20">20</option><option value="25">25</option><option value="30">30</option><option value="35">35</option><option value="40">40</option><option value="45">45</option><option value="50">50</option><option value="55">55</option><option value="60">60</option></select><label for="font-color">Font Color:</label><input type="color" id="font-color" value="#000000"/><div style="display:flex;gap:10px;margin-top:10px;"><button onclick="applySettings()">Apply</button><button onclick="resetDefaults()">Reset</button></div></div></div>
<div id="help-modal" class="modal-centered" style="display:none;max-width:500px;"><button class="modal-close" id="help-close">√ó</button><div style="padding:20px;font-family:Arial;font-size:14px;color:#222;"><h2 style="text-align:center;">How to Use</h2><ul style="line-height:1.5;padding-left:18px;"><li><strong>Open PDF:</strong> Load a PDF.</li><li><strong>Save PDF:</strong> Export your edited PDF.</li><li><strong>Add Text:</strong> Double-click to add a text box.</li><li><strong>Edit Text:</strong> Click to edit. Right-click to delete.</li><li><strong>Add Signature:</strong> Draw, save, and place your signature.</li><li><strong>Font Settings:</strong> Adjust font, size, and color via Settings.</li><li><strong>Help:</strong> Click the red question mark for these tips.</li></ul></div></div>
</body>
</html>
