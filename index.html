<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>TurboSign 2.4 Gold</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" href="logo.png" sizes="192x192"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js"></script>
  <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <style>
    body { margin:0; font-family:Arial,sans-serif; background:#f5f5f5; }
    .toolbar {
      position:fixed; bottom:16px; left:50%; transform:translateX(-50%);
      width:90%; max-width:600px; height:56px;
      background:rgba(255,255,255,0.15); border:1px solid rgba(255,255,255,0.3);
      backdrop-filter:blur(10px); display:flex; gap:8px; justify-content:center; align-items:center;
      padding:0 8px; box-shadow:0 4px 20px rgba(0,0,0,0.1); border-radius:30px; z-index:1000;
    }
    .toolbar button {
      width:48px; height:48px; background:#333; border:none; border-radius:50%;
      display:flex; justify-content:center; align-items:center; cursor:pointer;
      transition:background 0.3s, transform 0.2s;
    }
    .toolbar button svg { stroke:#fff; width:24px; height:24px; }
    .toolbar button:hover { background:#444; transform:translateY(-2px); }
    .toolbar button.active { background:#000; border:2px solid #0ff; box-shadow:0 0 8px #0ff; }
    .toolbar button.active svg { stroke:#0ff; }
    #pdf-container {
      margin:20px; padding-bottom:100px; background:#eee; overflow-y:auto;
      height:calc(100vh - 100px); transform-origin:top center;
    }
    .page-wrapper { position:relative; }
    canvas {
      display:block; margin:20px auto; background:#fff;
      border:1px solid #ccc; border-radius:8px;
    }
    .draggable {
      position:absolute; cursor:move; user-select:text;
      font-family:Arial; white-space:pre-wrap; color:#000;
      font-size:15px; min-width:50px; min-height:20px; padding:2px;
    }
    .draggable.focused { outline:1px dashed #4CAF50; }
    .placeholder { color:#888; }
    #backdrop {
      display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.5); z-index:999;
    }
    .modal {
      display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      width:90%; max-width:360px; background:rgba(255,255,255,0.15);
      border:1px solid rgba(255,255,255,0.3); backdrop-filter:blur(10px);
      padding:20px; border-radius:30px; box-shadow:0 4px 20px rgba(0,0,0,0.1);
      z-index:1001; color:#333;
    }
    .modal h2 { margin-top:0; text-align:center; }
    .modal label { display:block; margin:10px 0; font-weight:bold; }
    .modal select, .modal input, .modal button {
      width:100%; margin-top:10px; padding:8px;
      border:1px solid rgba(255,255,255,0.5); border-radius:8px;
      background:rgba(51,51,51,0.5); color:#fff; cursor:pointer;
      box-sizing:border-box;
    }
    .modal button:hover { background:rgba(68,68,68,0.7); }
    #signature-modal canvas {
      width:100%; height:auto; box-sizing:border-box;
      border:1px solid rgba(255,255,255,0.5); border-radius:8px;
    }
    @media (max-width:480px) {
      .toolbar { bottom:8px; height:48px; gap:4px; }
      .toolbar button { width:40px; height:40px; }
      .toolbar button svg { width:20px; height:20px; }
      #pdf-container { margin:8px; padding-bottom:80px; height:calc(100vh - 88px); }
      .modal { width:95%; max-width:95%; border-radius:20px; padding:16px; }
      .modal select, .modal input, .modal button { padding:6px; }
      #signature-modal canvas { height:120px; }
    }
  </style>
</head>
<body>
  <div class="toolbar">
    <button id="btn-open"><i data-feather="folder"></i></button>
    <button id="btn-text"><i data-feather="type"></i></button>
    <button id="btn-stamp-ui"><i data-feather="check-circle"></i></button>
    <button id="btn-zoom-in"><i data-feather="zoom-in"></i></button>
    <button id="btn-zoom-out"><i data-feather="zoom-out"></i></button>
    <button id="btn-sign"><i data-feather="edit"></i></button>
    <button id="btn-settings"><i data-feather="settings"></i></button>
    <button id="btn-save"><i data-feather="download"></i></button>
  </div>

  <input type="file" id="file-input" accept="application/pdf" style="display:none"/>
  <div id="pdf-container"></div>
  <div id="backdrop"></div>

  <div id="stamp-modal" class="modal">
    <h2>Choose Stamp</h2>
    <div style="display:flex; justify-content:space-around;">
      <button data-mode="stamp-check"><i data-feather="check-circle"></i></button>
      <button data-mode="stamp-x"><i data-feather="x"></i></button>
      <button data-mode="stamp-rect"><i data-feather="square"></i></button>
    </div>
  </div>

  <div id="settings-modal" class="modal">
    <h2>Text Settings</h2>
    <label>Font:</label>
    <select id="font-family"><option>Arial</option><option>Verdana</option><option>Courier New</option></select>
    <label>Size:</label>
    <select id="font-size"><option>10</option><option selected>15</option><option>20</option><option>30</option></select>
    <label>Color:</label>
    <input type="color" id="font-color" value="#000000"/>
    <button id="apply-settings"><i data-feather="check"></i> Apply</button>
    <button id="reset-defaults"><i data-feather="refresh-cw"></i> Reset</button>
  </div>

  <div id="signature-modal" class="modal">
    <h2>Signature</h2>
    <canvas id="sig-canvas" width="400" height="150"></canvas>
    <button id="clear-sign"><i data-feather="trash-2"></i> Clear</button>
    <button id="save-sign"><i data-feather="check"></i> Save</button>
  </div>

  <div id="save-modal" class="modal">
    <h2>Save PDF</h2>
    <label>File Name:</label>
    <input type="text" id="save-filename" placeholder="exported.pdf"/>
    <button id="download-pdf"><i data-feather="download"></i> Download</button>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded',async()=>{
    feather.replace();
    pdfjsLib.GlobalWorkerOptions.workerSrc='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    const fileInput=document.getElementById('file-input'),
          container=document.getElementById('pdf-container'),
          backdrop=document.getElementById('backdrop'),
          btnOpen=document.getElementById('btn-open'),
          btnText=document.getElementById('btn-text'),
          btnStampUI=document.getElementById('btn-stamp-ui'),
          btnZoomIn=document.getElementById('btn-zoom-in'),
          btnZoomOut=document.getElementById('btn-zoom-out'),
          btnSign=document.getElementById('btn-sign'),
          btnSettings=document.getElementById('btn-settings'),
          btnSave=document.getElementById('btn-save'),
          stampModal=document.getElementById('stamp-modal'),
          settingsModal=document.getElementById('settings-modal'),
          signatureModal=document.getElementById('signature-modal'),
          saveModal=document.getElementById('save-modal');

    let currentMode=null, scale=1,
        defaultFont='Arial', defaultSize=15, defaultColor='#000',
        signatureData=null;

    function clearActive(){
      [btnOpen,btnText,btnStampUI,btnZoomIn,btnZoomOut,btnSign,btnSettings,btnSave]
        .forEach(b=>b.classList.remove('active'));
      currentMode=null;
    }
    function openModal(m){ backdrop.style.display='block'; m.style.display='block'; }
    function closeModals(){ backdrop.style.display='none'; [stampModal,settingsModal,signatureModal,saveModal].forEach(m=>m.style.display='none'); }

    btnOpen.onclick=()=>{
      clearActive(); btnOpen.classList.add('active'); fileInput.click();
    };
    fileInput.onchange=async e=>{
      const file=e.target.files[0]; if(!file) return;
      const pdf=await pdfjsLib.getDocument({data:await file.arrayBuffer()}).promise;
      container.innerHTML='';
      for(let i=1;i<=pdf.numPages;i++){
        const page=await pdf.getPage(i),
              vp=page.getViewport({scale:1.25}),
              wrap=document.createElement('div'),
              c=document.createElement('canvas');
        wrap.className='page-wrapper';
        c.width=vp.width; c.height=vp.height;
        wrap.appendChild(c); container.appendChild(wrap);
        await page.render({canvasContext:c.getContext('2d'),viewport:vp}).promise;
      }
    };

    btnText.onclick=()=>{
      clearActive(); btnText.classList.add('active');
      currentMode='text'; closeModals();
    };

    btnStampUI.onclick=()=>{
      clearActive(); btnStampUI.classList.add('active');
      openModal(stampModal);
    };
    stampModal.querySelectorAll('button[data-mode]').forEach(b=>{
      b.onclick=()=>{
        clearActive(); btnStampUI.classList.add('active');
        currentMode=b.dataset.mode; closeModals();
      };
    });

    btnZoomIn.onclick=()=>{
      clearActive(); btnZoomIn.classList.add('active');
      scale=Math.min(3,scale+0.25);
      container.style.transform=`scale(${scale})`;
    };
    btnZoomOut.onclick=()=>{
      clearActive(); btnZoomOut.classList.add('active');
      scale=Math.max(0.5,scale-0.25);
      container.style.transform=`scale(${scale})`;
    };

    btnSign.onclick=()=>{
      clearActive(); btnSign.classList.add('active');
      currentMode='sign'; openModal(signatureModal);
      initSignaturePad();
    };

    btnSettings.onclick=()=>{
      clearActive(); btnSettings.classList.add('active');
      openModal(settingsModal);
    };
    document.getElementById('apply-settings').onclick=()=>{
      defaultFont=document.getElementById('font-family').value;
      defaultSize=+document.getElementById('font-size').value;
      defaultColor=document.getElementById('font-color').value;
      document.querySelectorAll('.draggable').forEach(el=>{
        el.style.fontFamily=defaultFont;
        el.style.fontSize=defaultSize+'px';
        el.style.color=defaultColor;
      });
      closeModals();
    };
    document.getElementById('reset-defaults').onclick=()=>{
      document.getElementById('font-family').value='Arial';
      document.getElementById('font-size').value='15';
      document.getElementById('font-color').value='#000000';
    };

    btnSave.onclick=()=>{
      clearActive(); btnSave.classList.add('active');
      openModal(saveModal);
    };
    document.getElementById('download-pdf').onclick=async()=>{
      const fname=document.getElementById('save-filename').value||'exported.pdf',
            {PDFDocument}=PDFLib,
            pdfDoc=await PDFDocument.create();
      for(const c of container.querySelectorAll('canvas')){
        const p=pdfDoc.addPage([c.width,c.height]),
              img=await pdfDoc.embedJpg(c.toDataURL('image/jpeg',0.8));
        p.drawImage(img,{x:0,y:0,width:c.width,height:c.height});
      }
      const bytes=await pdfDoc.save(),
            a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([bytes],{type:'application/pdf'}));
      a.download=fname; a.click(); closeModals();
    };

    const sigCanvas=document.getElementById('sig-canvas'),
          sigCtx=sigCanvas.getContext('2d');
    function initSignaturePad(){
      sigCtx.clearRect(0,0,sigCanvas.width,sigCanvas.height);
      sigCtx.strokeStyle='#ccc'; sigCtx.lineWidth=1;
      sigCtx.beginPath(); sigCtx.moveTo(0,sigCanvas.height*0.8);
      sigCtx.lineTo(sigCanvas.width,sigCanvas.height*0.8);
      sigCtx.stroke(); sigCtx.strokeStyle='#000'; sigCtx.lineWidth=2;
      let drawing=false;
      sigCanvas.onmousedown=e=>{drawing=true;sigCtx.beginPath();sigCtx.moveTo(e.offsetX,e.offsetY);};
      sigCanvas.onmouseup=()=>(drawing=false);
      sigCanvas.onmousemove=e=>{if(drawing){sigCtx.lineTo(e.offsetX,e.offsetY);sigCtx.stroke();}};
    }
    document.getElementById('clear-sign').onclick=()=>initSignaturePad();
    document.getElementById('save-sign').onclick=()=>{
      signatureData=sigCanvas.toDataURL(); closeModals();
    };

    function enableDrag(el){
      let ox=0,oy=0,drag=false;
      const start=e=>{
        e.preventDefault(); drag=true;
        const cx=e.touches?e.touches[0].clientX:e.clientX,
              cy=e.touches?e.touches[0].clientY:e.clientY;
        ox=cx-parseFloat(el.style.left||0);
        oy=cy-parseFloat(el.style.top||0);
      },
      move=e=>{
        if(!drag) return; e.preventDefault();
        const cx=e.touches?e.touches[0].clientX:e.clientX,
              cy=e.touches?e.touches[0].clientY:e.clientY;
        el.style.left=(cx-ox)+'px';
        el.style.top=(cy-oy)+'px';
      },
      end=()=>drag=false;
      el.addEventListener('mousedown',start);
      el.addEventListener('touchstart',start,{passive:false});
      document.addEventListener('mousemove',move);
      document.addEventListener('touchmove',move,{passive:false});
      document.addEventListener('mouseup',end);
      document.addEventListener('touchend',end);
    }

    container.ondblclick=e=>{
      const canvasEl=e.target.closest('canvas');
      if(!canvasEl) return;
      const wrap=canvasEl.parentElement,
            rect=canvasEl.getBoundingClientRect(),
            x=(e.clientX-rect.left)/scale,
            y=(e.clientY-rect.top)/scale;
      if(currentMode==='text'){
        const d=document.createElement('div');
        d.contentEditable=true; d.spellcheck=false;
        d.className='draggable placeholder';
        d.style.left=x+'px'; d.style.top=y+'px';
        d.style.fontFamily=defaultFont;
        d.style.fontSize=defaultSize+'px';
        d.style.color=defaultColor;
        d.textContent='Edit text'; wrap.appendChild(d);
        enableDrag(d);
        d.addEventListener('focus',()=>{
          d.classList.add('focused');
          if(d.textContent==='Edit text') d.textContent='';
        });
        d.addEventListener('blur',()=>{
          d.classList.remove('focused');
          if(!d.textContent.trim()) d.textContent='Edit text';
        });
      } else if(currentMode&&currentMode.startsWith('stamp-')){
        const nm=currentMode==='stamp-check'?'check-circle':
                 currentMode==='stamp-x'?'x':'square';
        const i=document.createElement('i');
        i.setAttribute('data-feather',nm);
        i.className='draggable';
        wrap.appendChild(i);
        feather.replace({container:i.parentNode});
        i.style.left=x+'px'; i.style.top=y+'px';
        enableDrag(i);
      } else if(currentMode==='sign'&&signatureData){
        const img=document.createElement('img');
        img.src=signatureData;
        img.className='draggable';
        wrap.appendChild(img);
        img.style.left=x+'px'; img.style.top=y+'px';
        enableDrag(img);
      }
    };

    container.onclick=e=>{
      if(e.target.classList.contains('draggable')&&e.target.tagName==='DIV'){
        clearActive();
        currentMode='text';
        e.target.contentEditable=true;
        e.target.focus();
      }
    };

    backdrop.onclick=closeModals;
  });
  </script>
</body>
</html>
